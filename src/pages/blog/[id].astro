---
import type { GetStaticPaths } from "astro";
import { Picture } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import { getCollection, render } from "astro:content";
import Layout from "~/layouts/Layout.astro";
import { formatDate } from "~/utils/format-date";

type Props = {
  post: CollectionEntry<"blog">;
};

export const getStaticPaths = (async () => {
  const posts = await getCollection("blog");

  return posts.map((post) => ({
    params: { id: post.id },
    props: { post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { Content } = await render(post);
const { title, subtitle, publicationDate, tags, image, imageAlt } = post.data;
---

<Layout title={title}>
  <article class="mx-auto w-full max-w-6xl px-6 py-12">
    <div class="space-y-6">
      <div class="space-y-3">
        <p
          class="text-sm font-semibold tracking-[0.2em] text-jet-black/60 uppercase"
        >
          {formatDate(publicationDate)}
        </p>
        <h1 class="font-display text-4xl font-semibold text-onyx sm:text-5xl">
          {title}
        </h1>
        {
          subtitle && (
            <p class="max-w-2xl text-lg text-jet-black/70">{subtitle}</p>
          )
        }
        {
          tags?.length && (
            <ul class="flex flex-wrap gap-2 text-xs font-medium text-jet-black/70">
              {tags.map((tag) => (
                <li class="rounded-full border border-jet-black/10 px-3 py-1">
                  {tag}
                </li>
              ))}
            </ul>
          )
        }
      </div>

      {
        image && (
          <div class="overflow-hidden rounded-3xl border border-jet-black/10 bg-white shadow-sm">
            <Picture
              alt={imageAlt}
              class="w-full object-cover"
              fallbackFormat="webp"
              formats={["avif"]}
              priority
              sizes="min(72rem, 100vw)"
              src={image}
              widths={[320, 480, 640, 960, 1280, 1600, 1920, 2560, 2816]}
            />
          </div>
        )
      }

      <div class="prose max-w-none prose-neutral">
        <Content />
      </div>
    </div>
  </article>
</Layout>
